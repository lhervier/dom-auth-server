<?xml version="1.0" encoding="UTF-8"?>
<faces-config>
  <!-- Bean pour accéder au paramétrage -->
  <managed-bean>
    <managed-bean-name>paramsBean</managed-bean-name>
    <managed-bean-class>com.github.lhervier.domino.oauth.library.server.bean.ParamsBean</managed-bean-class>
    <managed-bean-scope>session</managed-bean-scope>
    <managed-property>
  		<property-name>notesContext</property-name>
  		<value>#{notesContext}</value>
  	</managed-property>
  </managed-bean>
  
  <!-- Bean pour accéder au NAB défini dans le paramétrage (via la session courante) -->
  <managed-bean>
  	<managed-bean-name>nab</managed-bean-name>
  	<managed-bean-class>com.github.lhervier.domino.oauth.common.DatabaseWrapper</managed-bean-class>
  	<managed-bean-scope>request</managed-bean-scope>
  	<managed-property>
  		<property-name>asSigner</property-name>
  		<value>false</value>
  	</managed-property>
  	<managed-property>
  		<property-name>filePath</property-name>
  		<value>#{paramsBean.nab}</value>
  	</managed-property>
  </managed-bean>
  
  <!-- Bean pour accéder au NAB défini dans le paramétrage (via session "as signer") -->
  <managed-bean>
  	<managed-bean-name>nabAsSigner</managed-bean-name>
  	<managed-bean-class>com.github.lhervier.domino.oauth.common.DatabaseWrapper</managed-bean-class>
  	<managed-bean-scope>request</managed-bean-scope>
  	<managed-property>
  		<property-name>asSigner</property-name>
  		<value>true</value>
  	</managed-property>
  	<managed-property>
  		<property-name>filePath</property-name>
  		<value>#{paramsBean.nab}</value>
  	</managed-property>
  </managed-bean>
  
  <!-- Bean pour accéder au secret Ltpa -->
  <managed-bean>
    <managed-bean-name>secretBean</managed-bean-name>
    <managed-bean-class>com.github.lhervier.domino.oauth.library.server.bean.SecretBean</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
    <managed-property>
    	<property-name>paramsBean</property-name>
    	<value>#{paramsBean}</value>
    </managed-property>
    <managed-property>
    	<property-name>nabAsSigner</property-name>
    	<value>#{nabAsSigner}</value>
    </managed-property>
  </managed-bean>
  
  <!-- Bean pour manipuler les applications OAUTH -->
  <managed-bean>
    <managed-bean-name>appBean</managed-bean-name>
    <managed-bean-class>com.github.lhervier.domino.oauth.library.server.bean.AppBean</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
    <managed-property>
    	<property-name>database</property-name>
    	<value>#{database}</value>
    </managed-property>
    <managed-property>
    	<property-name>nab</property-name>
    	<value>#{nab}</value>
    </managed-property>
    <managed-property>
    	<property-name>paramsBean</property-name>
    	<value>#{paramsBean}</value>
    </managed-property>
  </managed-bean>
  
  <!-- Bean pour gérer le endpoint Authorize -->
  <managed-bean>
    <managed-bean-name>authorizeBean</managed-bean-name>
    <managed-bean-class>com.github.lhervier.domino.oauth.library.server.bean.AuthorizeBean</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
    <managed-property>
    	<property-name>appBean</property-name>
    	<value>#{appBean}</value>
    </managed-property>
    <managed-property>
    	<property-name>paramsBean</property-name>
    	<value>#{paramsBean}</value>
    </managed-property>
    <managed-property>
    	<property-name>param</property-name>
    	<value>#{param}</value>
    </managed-property>
    <managed-property>
    	<property-name>notesContext</property-name>
    	<value>#{notesContext}</value>
    </managed-property>
    <managed-property>
    	<property-name>requestScope</property-name>
    	<value>#{requestScope}</value>
    </managed-property>
  </managed-bean>
  
  <!-- Bean pour gérer le endpoint Token -->
  <managed-bean>
    <managed-bean-name>tokenBean</managed-bean-name>
    <managed-bean-class>com.github.lhervier.domino.oauth.library.server.bean.TokenBean</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
    <managed-property>
    	<property-name>appBean</property-name>
    	<value>#{appBean}</value>
    </managed-property>
    <managed-property>
    	<property-name>secretBean</property-name>
    	<value>#{secretBean}</value>
    </managed-property>
    <managed-property>
    	<property-name>paramsBean</property-name>
    	<value>#{paramsBean}</value>
    </managed-property>
    <managed-property>
    	<property-name>database</property-name>
    	<value>#{database}</value>
    </managed-property>
    <managed-property>
    	<property-name>notesContext</property-name>
    	<value>#{notesContext}</value>
    </managed-property>
    <managed-property>
    	<property-name>param</property-name>
    	<value>#{param}</value>
    </managed-property>
    <managed-property>
    	<property-name>context</property-name>
    	<value>#{context}</value>
    </managed-property>
    <managed-property>
    	<property-name>response</property-name>
    	<value>#{facesContext.externalContext.response}</value>
    </managed-property>
    <managed-property>
    	<property-name>request</property-name>
    	<value>#{facesContext.externalContext.request}</value>
    </managed-property>
  </managed-bean>
  
  <!-- Vérification du rôle à chaque chargement de XPage -->
  <!-- FIXME: Utilise un phaseListener à la place -->
  <managed-bean>
    <managed-bean-name>utils</managed-bean-name>
    <managed-bean-class>com.github.lhervier.domino.oauth.library.server.utils.Utils</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
  </managed-bean>
</faces-config>
